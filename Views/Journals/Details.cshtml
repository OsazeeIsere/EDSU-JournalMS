@using EDSU_JournalMS.Authorization
@using static EDSU_JournalMS.Models.Enum
@model EDSU_JournalMS.Models.EDSUJournal
@inject IAuthorizationService AuthorizationService
@using Microsoft.AspNetCore.Authorization;
@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>Article</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Title)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Title)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Authors)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Authors)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Keywords)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Keywords)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Abstract)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Abstract)
        </dd>
       
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.NoOfPages)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.NoOfPages)
        </dd>
        <dt class = "col-sm-2">
            <h6><span>Complete Uploaded Article</span></h6>
            @*@Html.DisplayNameFor(model => model.Upload*@
        </dt>
        <dd class = "col-sm-10">
            @Html.ActionLink("Download", "DownloadFile", new{FileName = Model.Upload})
        </dd>
        
        
        <dt class = "col-sm-2">
         <h6><span>Date Uploaded</span></h6>

            @*@Html.DisplayNameFor(model => model.CreatedAt)*@
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.CreatedAt)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.UploadedBy)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.UploadedBy)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Status)
        </dd>
    </dl>
</div>
@{
    
  var isAuthorized = await AuthorizationService.AuthorizeAsync(
				User, Model, ArticleOperations.Rejected);

	@if (isAuthorized.Succeeded)
	{		
         @if (Model.Status != ArticleStatus.Accepted)
		{
			<form style="display:inline;" method="post">
				<input hidden name="id" value="@Model.Id">
				<input hidden name="status" value="@ArticleStatus.Accepted">
				<button type="submit" class="btn btn-xs btn-success">Accepted</button>
			</form>
		}

		@if (Model.Status != ArticleStatus.Rejected)
		{
			<form style="display:inline;" method="post">
				<input hidden name="id" value="@Model.Id">
				<input hidden name="status" value="@ArticleStatus.Rejected">
				<button type="submit" class="btn btn-xs btn-danger">Rejected</button>
			</form>
		}
	}
}

<div>
    @if(isAuthorized.Succeeded==false)
    {
      <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> 
    }
    <a asp-action="Index">Back to List</a>
</div>

